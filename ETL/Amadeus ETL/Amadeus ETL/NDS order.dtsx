<?xml version="1.0"?><DTS:Executable xmlns:DTS="www.microsoft.com/SqlServer/Dts" DTS:ExecutableType="MSDTS.Package.1"><DTS:Property DTS:Name="PackageFormatVersion">2</DTS:Property><DTS:Property DTS:Name="VersionComments"></DTS:Property><DTS:Property DTS:Name="CreatorName">VIVA2\Vinival</DTS:Property><DTS:Property DTS:Name="CreatorComputerName">VIVA2</DTS:Property><DTS:Property DTS:Name="CreationDate" DTS:DataType="7">4/22/2007 6:42:58 PM</DTS:Property><DTS:Property DTS:Name="PackageType">5</DTS:Property><DTS:Property DTS:Name="ProtectionLevel">1</DTS:Property><DTS:Property DTS:Name="MaxConcurrentExecutables">-1</DTS:Property><DTS:Property DTS:Name="PackagePriorityClass">0</DTS:Property><DTS:Property DTS:Name="VersionMajor">1</DTS:Property><DTS:Property DTS:Name="VersionMinor">0</DTS:Property><DTS:Property DTS:Name="VersionBuild">13</DTS:Property><DTS:Property DTS:Name="VersionGUID">{92033540-0DB1-4BB4-9026-26CC9FE41FB6}</DTS:Property><DTS:Property DTS:Name="EnableConfig">0</DTS:Property><DTS:Property DTS:Name="CheckpointFileName"></DTS:Property><DTS:Property DTS:Name="SaveCheckpoints">0</DTS:Property><DTS:Property DTS:Name="CheckpointUsage">0</DTS:Property><DTS:Property DTS:Name="SuppressConfigurationWarnings">0</DTS:Property>
<DTS:ConnectionManager><DTS:Property DTS:Name="DelayValidation">0</DTS:Property><DTS:Property DTS:Name="ObjectName">viva2.NDS.ETL</DTS:Property><DTS:Property DTS:Name="DTSID">{674108CD-DB02-4343-85C4-0B3DFDF94F06}</DTS:Property><DTS:Property DTS:Name="Description"></DTS:Property><DTS:Property DTS:Name="CreationName">OLEDB</DTS:Property><DTS:ObjectData><DTS:ConnectionManager><DTS:Property DTS:Name="Retain">0</DTS:Property><DTS:Password DTS:Name="Password" Sensitive="1" Encrypted="1">AQAAANCMnd8BFdERjHoAwE/Cl+sBAAAA045kkKm4Nk+RGHddbXjq4wAAAAAIAAAARABUAFMAAAADZgAAqAAAABAAAACJWQqWeGTP8Jr3bowDil9cAAAAAASAAACgAAAAEAAAACDdfsF1nMuQ0vK6/v4CNakIAAAAH537cJKWwqAUAAAA6lLhnILNLpoc+ZCLPPuST8c2Bzo</DTS:Password><DTS:Property DTS:Name="ConnectionString">Data Source=viva2;User ID=ETL;Initial Catalog=NDS;Provider=SQLNCLI.1;Persist Security Info=True;Auto Translate=False;</DTS:Property></DTS:ConnectionManager></DTS:ObjectData></DTS:ConnectionManager>
<DTS:PackageVariable><DTS:Property DTS:Name="PackageVariableValue" DTS:DataType="8">&lt;Package xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:dwd="http://schemas.microsoft.com/DataWarehouse/Designer/1.0"&gt;&lt;dwd:DtsControlFlowDiagram&gt;&lt;dwd:BoundingLeft&gt;-10332&lt;/dwd:BoundingLeft&gt;&lt;dwd:Layout&gt;&lt;dds&gt;
  &lt;diagram fontclsid="{0BE35203-8F91-11CE-9DE3-00AA004BB851}" mouseiconclsid="{0BE35204-8F91-11CE-9DE3-00AA004BB851}" defaultlayout="Microsoft.DataWarehouse.Layout.GraphLayout" defaultlineroute="Microsoft.DataWarehouse.Layout.GraphLayout" version="7" nextobject="18" scale="100" pagebreakanchorx="0" pagebreakanchory="0" pagebreaksizex="0" pagebreaksizey="0" scrollleft="-11332" scrolltop="-580" gridx="150" gridy="150" marginx="1000" marginy="1000" zoom="100" x="22251" y="13335" backcolor="15334399" defaultpersistence="2" PrintPageNumbersMode="3" PrintMarginTop="0" PrintMarginBottom="635" PrintMarginLeft="0" PrintMarginRight="0" marqueeselectionmode="1" mousepointer="0" snaptogrid="0" autotypeannotation="1" showscrollbars="0" viewpagebreaks="0" donotforceconnectorsbehindshapes="1" backpictureclsid="{00000000-0000-0000-0000-000000000000}"&gt;
    &lt;font&gt;
      &lt;ddsxmlobjectstreamwrapper binary="01010000900180380100065461686f6d61" /&gt;
    &lt;/font&gt;
    &lt;mouseicon&gt;
      &lt;ddsxmlobjectstreamwrapper binary="6c74000000000000" /&gt;
    &lt;/mouseicon&gt;
  &lt;/diagram&gt;
  &lt;layoutmanager&gt;
    &lt;ddsxmlobj /&gt;
  &lt;/layoutmanager&gt;
  &lt;ddscontrol controlprogid="DdsShapes.DdsObjectManagedBridge.1" tooltip="Execute SQL Task" left="-10332" top="4328" logicalid="8" controlid="1" masterid="0" hint1="0" hint2="0" width="3598" height="1164" noresize="0" nomove="0" nodefaultattachpoints="0" autodrag="1" usedefaultiddshape="1" selectable="1" showselectionhandles="1" allownudging="1" isannotation="0" dontautolayout="0" groupcollapsed="0" tabstop="1" visible="1" snaptogrid="0"&gt;
    &lt;control&gt;
      &lt;ddsxmlobjectstreaminitwrapper binary="000800000e0e00008c040000" /&gt;
    &lt;/control&gt;
    &lt;layoutobject&gt;
      &lt;ddsxmlobj&gt;
        &lt;property name="LogicalObject" value="{BAE4C9E8-06A6-41C3-BEA9-7EBCD72EF88E}" vartype="8" /&gt;
        &lt;property name="ShowConnectorSource" value="0" vartype="2" /&gt;
      &lt;/ddsxmlobj&gt;
    &lt;/layoutobject&gt;
    &lt;shape groupshapeid="0" groupnode="0" /&gt;
  &lt;/ddscontrol&gt;
  &lt;ddscontrol controlprogid="DdsShapes.DdsObjectManagedBridge.1" tooltip="Execute SQL Task" left="-10332" top="0" logicalid="9" controlid="2" masterid="0" hint1="0" hint2="0" width="3598" height="1164" noresize="0" nomove="0" nodefaultattachpoints="0" autodrag="1" usedefaultiddshape="1" selectable="1" showselectionhandles="1" allownudging="1" isannotation="0" dontautolayout="0" groupcollapsed="0" tabstop="1" visible="1" snaptogrid="0"&gt;
    &lt;control&gt;
      &lt;ddsxmlobjectstreaminitwrapper binary="000800000e0e00008c040000" /&gt;
    &lt;/control&gt;
    &lt;layoutobject&gt;
      &lt;ddsxmlobj&gt;
        &lt;property name="LogicalObject" value="{956E60CF-3EA3-44F9-82E4-6828058541AA}" vartype="8" /&gt;
        &lt;property name="ShowConnectorSource" value="0" vartype="2" /&gt;
      &lt;/ddsxmlobj&gt;
    &lt;/layoutobject&gt;
    &lt;shape groupshapeid="0" groupnode="0" /&gt;
  &lt;/ddscontrol&gt;
  &lt;ddscontrol controlprogid="DdsShapes.DdsObjectManagedBridge.1" tooltip="Execute SQL Task" left="-10332" top="2164" logicalid="10" controlid="3" masterid="0" hint1="0" hint2="0" width="3598" height="1164" noresize="0" nomove="0" nodefaultattachpoints="0" autodrag="1" usedefaultiddshape="1" selectable="1" showselectionhandles="1" allownudging="1" isannotation="0" dontautolayout="0" groupcollapsed="0" tabstop="1" visible="1" snaptogrid="0"&gt;
    &lt;control&gt;
      &lt;ddsxmlobjectstreaminitwrapper binary="000800000e0e00008c040000" /&gt;
    &lt;/control&gt;
    &lt;layoutobject&gt;
      &lt;ddsxmlobj&gt;
        &lt;property name="LogicalObject" value="{E6788F08-9B56-449A-9118-3650DC93D4E8}" vartype="8" /&gt;
        &lt;property name="ShowConnectorSource" value="0" vartype="2" /&gt;
      &lt;/ddsxmlobj&gt;
    &lt;/layoutobject&gt;
    &lt;shape groupshapeid="0" groupnode="0" /&gt;
  &lt;/ddscontrol&gt;
  &lt;ddscontrol controlprogid="MSDDS.Polyline" left="-8932" top="765" logicalid="11" controlid="4" masterid="0" hint1="0" hint2="0" width="799" height="1899" noresize="0" nomove="0" nodefaultattachpoints="1" autodrag="0" usedefaultiddshape="0" selectable="1" showselectionhandles="0" allownudging="1" isannotation="0" dontautolayout="0" groupcollapsed="0" tabstop="1" visible="1" snaptogrid="0"&gt;
    &lt;control&gt;
      &lt;ddsxmlobj&gt;
        &lt;polyline endtypedst="3" endtypesrc="1" usercolor="32768" linestyle="0" linerender="2" customendtypedstid="0" customendtypesrcid="0" adornsvisible="1" /&gt;
      &lt;/ddsxmlobj&gt;
    &lt;/control&gt;
    &lt;layoutobject&gt;
      &lt;ddsxmlobj&gt;
        &lt;property name="LogicalObject" value="{C73A5AEC-B847-49C0-8371-98A3C14881A2}" vartype="8" /&gt;
        &lt;property name="Virtual" value="0" vartype="11" /&gt;
        &lt;property name="VisibleAP" value="0" vartype="3" /&gt;
      &lt;/ddsxmlobj&gt;
    &lt;/layoutobject&gt;
    &lt;connector lineroutestyle="Microsoft.DataWarehouse.Layout.GraphLayout" sourceid="2" destid="3" sourceattachpoint="7" destattachpoint="6" segmenteditmode="0" bendpointeditmode="0" bendpointvisibility="2" relatedid="0" virtual="0"&gt;
      &lt;point x="-8533" y="1164" /&gt;
      &lt;point x="-8533" y="2164" /&gt;
    &lt;/connector&gt;
  &lt;/ddscontrol&gt;
  &lt;ddscontrol controlprogid="MSDDS.Polyline" left="-8932" top="2929" logicalid="12" controlid="5" masterid="0" hint1="0" hint2="0" width="799" height="1899" noresize="0" nomove="0" nodefaultattachpoints="1" autodrag="0" usedefaultiddshape="0" selectable="1" showselectionhandles="0" allownudging="1" isannotation="0" dontautolayout="0" groupcollapsed="0" tabstop="1" visible="1" snaptogrid="0"&gt;
    &lt;control&gt;
      &lt;ddsxmlobj&gt;
        &lt;polyline endtypedst="3" endtypesrc="1" usercolor="32768" linestyle="0" linerender="2" customendtypedstid="0" customendtypesrcid="0" adornsvisible="1" /&gt;
      &lt;/ddsxmlobj&gt;
    &lt;/control&gt;
    &lt;layoutobject&gt;
      &lt;ddsxmlobj&gt;
        &lt;property name="LogicalObject" value="{F2820D4F-E525-425B-9D80-2EC0BB588546}" vartype="8" /&gt;
        &lt;property name="Virtual" value="0" vartype="11" /&gt;
        &lt;property name="VisibleAP" value="0" vartype="3" /&gt;
      &lt;/ddsxmlobj&gt;
    &lt;/layoutobject&gt;
    &lt;connector lineroutestyle="Microsoft.DataWarehouse.Layout.GraphLayout" sourceid="3" destid="1" sourceattachpoint="7" destattachpoint="6" segmenteditmode="0" bendpointeditmode="0" bendpointvisibility="2" relatedid="0" virtual="0"&gt;
      &lt;point x="-8533" y="3328" /&gt;
      &lt;point x="-8533" y="4328" /&gt;
    &lt;/connector&gt;
  &lt;/ddscontrol&gt;
  &lt;ddscontrol controlprogid="DdsShapes.DdsObjectManagedBridge.1" tooltip="Execute SQL Task" left="-10332" top="6492" logicalid="13" controlid="6" masterid="0" hint1="0" hint2="0" width="3598" height="1164" noresize="0" nomove="0" nodefaultattachpoints="0" autodrag="1" usedefaultiddshape="1" selectable="1" showselectionhandles="1" allownudging="1" isannotation="0" dontautolayout="0" groupcollapsed="0" tabstop="1" visible="1" snaptogrid="0"&gt;
    &lt;control&gt;
      &lt;ddsxmlobjectstreaminitwrapper binary="000800000e0e00008c040000" /&gt;
    &lt;/control&gt;
    &lt;layoutobject&gt;
      &lt;ddsxmlobj&gt;
        &lt;property name="LogicalObject" value="{5EA68E35-346B-45E7-9329-E9FF5A9A26ED}" vartype="8" /&gt;
        &lt;property name="ShowConnectorSource" value="0" vartype="2" /&gt;
      &lt;/ddsxmlobj&gt;
    &lt;/layoutobject&gt;
    &lt;shape groupshapeid="0" groupnode="0" /&gt;
  &lt;/ddscontrol&gt;
  &lt;ddscontrol controlprogid="MSDDS.Polyline" left="-8932" top="5093" logicalid="14" controlid="7" masterid="0" hint1="0" hint2="0" width="799" height="1899" noresize="0" nomove="0" nodefaultattachpoints="1" autodrag="0" usedefaultiddshape="0" selectable="1" showselectionhandles="0" allownudging="1" isannotation="0" dontautolayout="0" groupcollapsed="0" tabstop="1" visible="1" snaptogrid="0"&gt;
    &lt;control&gt;
      &lt;ddsxmlobj&gt;
        &lt;polyline endtypedst="3" endtypesrc="1" usercolor="32768" linestyle="0" linerender="2" customendtypedstid="0" customendtypesrcid="0" adornsvisible="1" /&gt;
      &lt;/ddsxmlobj&gt;
    &lt;/control&gt;
    &lt;layoutobject&gt;
      &lt;ddsxmlobj&gt;
        &lt;property name="LogicalObject" value="{20D5C0EE-14DA-4FBB-BC96-D60624DE3D93}" vartype="8" /&gt;
        &lt;property name="Virtual" value="0" vartype="11" /&gt;
        &lt;property name="VisibleAP" value="0" vartype="3" /&gt;
      &lt;/ddsxmlobj&gt;
    &lt;/layoutobject&gt;
    &lt;connector lineroutestyle="Microsoft.DataWarehouse.Layout.GraphLayout" sourceid="1" destid="6" sourceattachpoint="7" destattachpoint="6" segmenteditmode="0" bendpointeditmode="0" bendpointvisibility="2" relatedid="0" virtual="0"&gt;
      &lt;point x="-8533" y="5492" /&gt;
      &lt;point x="-8533" y="6492" /&gt;
    &lt;/connector&gt;
  &lt;/ddscontrol&gt;
&lt;/dds&gt;&lt;/dwd:Layout&gt;&lt;dwd:PersistedViewPortLeft&gt;-11332&lt;/dwd:PersistedViewPortLeft&gt;&lt;dwd:PersistedViewPortTop&gt;-580&lt;/dwd:PersistedViewPortTop&gt;&lt;/dwd:DtsControlFlowDiagram&gt;&lt;/Package&gt;</DTS:Property><DTS:Property DTS:Name="Namespace">dts-designer-1.0</DTS:Property><DTS:Property DTS:Name="ObjectName">{33944366-DCD1-4DB0-BA36-2D150C635211}</DTS:Property><DTS:Property DTS:Name="DTSID">{A4C21C9B-BB31-4EDD-9E48-76A9BBBFF68D}</DTS:Property><DTS:Property DTS:Name="Description"></DTS:Property><DTS:Property DTS:Name="CreationName"></DTS:Property></DTS:PackageVariable><DTS:Property DTS:Name="ForceExecValue">0</DTS:Property><DTS:Property DTS:Name="ExecValue" DTS:DataType="3">0</DTS:Property><DTS:Property DTS:Name="ForceExecutionResult">-1</DTS:Property><DTS:Property DTS:Name="Disabled">0</DTS:Property><DTS:Property DTS:Name="FailPackageOnFailure">0</DTS:Property><DTS:Property DTS:Name="FailParentOnFailure">0</DTS:Property><DTS:Property DTS:Name="MaxErrorCount">1</DTS:Property><DTS:Property DTS:Name="ISOLevel">1048576</DTS:Property><DTS:Property DTS:Name="LocaleID">2057</DTS:Property><DTS:Property DTS:Name="TransactionOption">1</DTS:Property><DTS:Property DTS:Name="DelayValidation">0</DTS:Property>
<DTS:LoggingOptions><DTS:Property DTS:Name="LoggingMode">0</DTS:Property><DTS:Property DTS:Name="FilterKind">1</DTS:Property><DTS:Property DTS:Name="EventFilter" DTS:DataType="8"></DTS:Property></DTS:LoggingOptions>
<DTS:Executable DTS:ExecutableType="Microsoft.SqlServer.Dts.Tasks.ExecuteSQLTask.ExecuteSQLTask, Microsoft.SqlServer.SQLTask, Version=9.0.242.0, Culture=neutral, PublicKeyToken=89845dcd8080cc91" DTS:ThreadHint="0"><DTS:Property DTS:Name="ExecutionLocation">0</DTS:Property><DTS:Property DTS:Name="ExecutionAddress"></DTS:Property><DTS:Property DTS:Name="TaskContact">Execute SQL Task; Microsoft Corporation; Microsoft SQL Server v9; © 2004 Microsoft Corporation; All Rights Reserved;http://www.microsoft.com/sql/support/default.asp;1</DTS:Property><DTS:Property DTS:Name="ForceExecValue">0</DTS:Property><DTS:Property DTS:Name="ExecValue" DTS:DataType="3">0</DTS:Property><DTS:Property DTS:Name="ForceExecutionResult">-1</DTS:Property><DTS:Property DTS:Name="Disabled">0</DTS:Property><DTS:Property DTS:Name="FailPackageOnFailure">0</DTS:Property><DTS:Property DTS:Name="FailParentOnFailure">0</DTS:Property><DTS:Property DTS:Name="MaxErrorCount">1</DTS:Property><DTS:Property DTS:Name="ISOLevel">1048576</DTS:Property><DTS:Property DTS:Name="LocaleID">-1</DTS:Property><DTS:Property DTS:Name="TransactionOption">1</DTS:Property><DTS:Property DTS:Name="DelayValidation">0</DTS:Property>
<DTS:LoggingOptions><DTS:Property DTS:Name="LoggingMode">0</DTS:Property><DTS:Property DTS:Name="FilterKind">1</DTS:Property><DTS:Property DTS:Name="EventFilter" DTS:DataType="8"></DTS:Property></DTS:LoggingOptions><DTS:Property DTS:Name="ObjectName">Upsert currency</DTS:Property><DTS:Property DTS:Name="DTSID">{956E60CF-3EA3-44F9-82E4-6828058541AA}</DTS:Property><DTS:Property DTS:Name="Description">Execute SQL Task</DTS:Property><DTS:Property DTS:Name="CreationName">Microsoft.SqlServer.Dts.Tasks.ExecuteSQLTask.ExecuteSQLTask, Microsoft.SqlServer.SQLTask, Version=9.0.242.0, Culture=neutral, PublicKeyToken=89845dcd8080cc91</DTS:Property><DTS:Property DTS:Name="DisableEventHandlers">0</DTS:Property><DTS:ObjectData><SQLTask:SqlTaskData SQLTask:Connection="{674108CD-DB02-4343-85C4-0B3DFDF94F06}" SQLTask:TimeOut="0" SQLTask:IsStoredProc="False" SQLTask:SqlStmtSourceType="DirectInput" SQLTask:SqlStatementSource="use nds&#xA;go&#xA;&#xA;-- Update where exists&#xA;update currency&#xA;set currency_name = c1.currency_name&#xA;, source_system_code = 3&#xA;, update_timestamp = getdate()&#xA;from stage.dbo.currency c1&#xA;left join currency c2&#xA;on c1.currency_code = c2.currency_code&#xA;where c1.currency_name &lt;&gt; c2.currency_name&#xA;go&#xA;&#xA;-- Insert where not exists&#xA;insert into currency&#xA;( currency_code, currency_name, source_system_code&#xA;, create_timestamp, update_timestamp )&#xA;select c1.currency_code, c1.currency_name&#xA;, 3 as source_system_code&#xA;, getdate() as create_timestamp&#xA;, getdate() as update_timestamp&#xA;from stage.dbo.currency c1&#xA;where not exists&#xA;( select * from currency c2&#xA;  where c1.currency_code = c2.currency_code )&#xA;go&#xA;" SQLTask:ResultType="ResultSetType_None" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask"/></DTS:ObjectData></DTS:Executable>
<DTS:Executable DTS:ExecutableType="Microsoft.SqlServer.Dts.Tasks.ExecuteSQLTask.ExecuteSQLTask, Microsoft.SqlServer.SQLTask, Version=9.0.242.0, Culture=neutral, PublicKeyToken=89845dcd8080cc91" DTS:ThreadHint="0"><DTS:Property DTS:Name="ExecutionLocation">0</DTS:Property><DTS:Property DTS:Name="ExecutionAddress"></DTS:Property><DTS:Property DTS:Name="TaskContact">Execute SQL Task; Microsoft Corporation; Microsoft SQL Server v9; © 2004 Microsoft Corporation; All Rights Reserved;http://www.microsoft.com/sql/support/default.asp;1</DTS:Property><DTS:Property DTS:Name="ForceExecValue">0</DTS:Property><DTS:Property DTS:Name="ExecValue" DTS:DataType="3">0</DTS:Property><DTS:Property DTS:Name="ForceExecutionResult">-1</DTS:Property><DTS:Property DTS:Name="Disabled">0</DTS:Property><DTS:Property DTS:Name="FailPackageOnFailure">0</DTS:Property><DTS:Property DTS:Name="FailParentOnFailure">0</DTS:Property><DTS:Property DTS:Name="MaxErrorCount">1</DTS:Property><DTS:Property DTS:Name="ISOLevel">1048576</DTS:Property><DTS:Property DTS:Name="LocaleID">-1</DTS:Property><DTS:Property DTS:Name="TransactionOption">1</DTS:Property><DTS:Property DTS:Name="DelayValidation">0</DTS:Property>
<DTS:LoggingOptions><DTS:Property DTS:Name="LoggingMode">0</DTS:Property><DTS:Property DTS:Name="FilterKind">1</DTS:Property><DTS:Property DTS:Name="EventFilter" DTS:DataType="8"></DTS:Property></DTS:LoggingOptions><DTS:Property DTS:Name="ObjectName">Upsert currency rate</DTS:Property><DTS:Property DTS:Name="DTSID">{E6788F08-9B56-449A-9118-3650DC93D4E8}</DTS:Property><DTS:Property DTS:Name="Description">Execute SQL Task</DTS:Property><DTS:Property DTS:Name="CreationName">Microsoft.SqlServer.Dts.Tasks.ExecuteSQLTask.ExecuteSQLTask, Microsoft.SqlServer.SQLTask, Version=9.0.242.0, Culture=neutral, PublicKeyToken=89845dcd8080cc91</DTS:Property><DTS:Property DTS:Name="DisableEventHandlers">0</DTS:Property><DTS:ObjectData><SQLTask:SqlTaskData SQLTask:Connection="{674108CD-DB02-4343-85C4-0B3DFDF94F06}" SQLTask:TimeOut="0" SQLTask:IsStoredProc="False" SQLTask:SqlStmtSourceType="DirectInput" SQLTask:SqlStatementSource="use nds&#xA;go&#xA;&#xA;-- Update where exists&#xA;update currency_rate&#xA;set currency_rate = convert(money&#xA; , coalesce(cr.currency_rate, 0))&#xA;from stage.dbo.currency_rate cr&#xA;left join currency c&#xA;  on cr.currency_code = c.currency_code&#xA;left join currency_rate cr2&#xA;  on cr.effective_date = cr2.effective_date&#xA; and c.currency_key = cr2.currency_key&#xA;where convert(money, coalesce(cr.currency_rate,0)) &#xA;  &lt;&gt; coalesce(cr2.currency_rate, 0)&#xA;go&#xA;&#xA;-- Insert where not exists&#xA;insert into currency_rate&#xA;( effective_date, currency_key&#xA;, currency_rate, source_system_code&#xA;, create_timestamp, update_timestamp )&#xA;select cr.effective_date&#xA;, coalesce(c.currency_key, 0) as currency_key&#xA;, convert(money, coalesce(cr.currency_rate, 0))&#xA;  as currency_rate&#xA;, 3 as source_system_code&#xA;, getdate() as create_timestamp&#xA;, getdate() as update_timestamp&#xA;from stage.dbo.currency_rate cr&#xA;left join currency c&#xA;  on cr.currency_code = c.currency_code&#xA;where not exists&#xA;( select * from currency_rate cr2&#xA;  where cr.effective_date = cr2.effective_date&#xA;  and c.currency_key = cr2.currency_key )&#xA;go&#xA;" SQLTask:ResultType="ResultSetType_None" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask"/></DTS:ObjectData></DTS:Executable>
<DTS:Executable DTS:ExecutableType="Microsoft.SqlServer.Dts.Tasks.ExecuteSQLTask.ExecuteSQLTask, Microsoft.SqlServer.SQLTask, Version=9.0.242.0, Culture=neutral, PublicKeyToken=89845dcd8080cc91" DTS:ThreadHint="0"><DTS:Property DTS:Name="ExecutionLocation">0</DTS:Property><DTS:Property DTS:Name="ExecutionAddress"></DTS:Property><DTS:Property DTS:Name="TaskContact">Execute SQL Task; Microsoft Corporation; Microsoft SQL Server v9; © 2004 Microsoft Corporation; All Rights Reserved;http://www.microsoft.com/sql/support/default.asp;1</DTS:Property><DTS:Property DTS:Name="ForceExecValue">0</DTS:Property><DTS:Property DTS:Name="ExecValue" DTS:DataType="3">0</DTS:Property><DTS:Property DTS:Name="ForceExecutionResult">-1</DTS:Property><DTS:Property DTS:Name="Disabled">0</DTS:Property><DTS:Property DTS:Name="FailPackageOnFailure">0</DTS:Property><DTS:Property DTS:Name="FailParentOnFailure">0</DTS:Property><DTS:Property DTS:Name="MaxErrorCount">1</DTS:Property><DTS:Property DTS:Name="ISOLevel">1048576</DTS:Property><DTS:Property DTS:Name="LocaleID">-1</DTS:Property><DTS:Property DTS:Name="TransactionOption">1</DTS:Property><DTS:Property DTS:Name="DelayValidation">0</DTS:Property>
<DTS:LoggingOptions><DTS:Property DTS:Name="LoggingMode">0</DTS:Property><DTS:Property DTS:Name="FilterKind">1</DTS:Property><DTS:Property DTS:Name="EventFilter" DTS:DataType="8"></DTS:Property></DTS:LoggingOptions><DTS:Property DTS:Name="ObjectName">Upsert Order Header</DTS:Property><DTS:Property DTS:Name="DTSID">{BAE4C9E8-06A6-41C3-BEA9-7EBCD72EF88E}</DTS:Property><DTS:Property DTS:Name="Description">Execute SQL Task</DTS:Property><DTS:Property DTS:Name="CreationName">Microsoft.SqlServer.Dts.Tasks.ExecuteSQLTask.ExecuteSQLTask, Microsoft.SqlServer.SQLTask, Version=9.0.242.0, Culture=neutral, PublicKeyToken=89845dcd8080cc91</DTS:Property><DTS:Property DTS:Name="DisableEventHandlers">0</DTS:Property><DTS:ObjectData><SQLTask:SqlTaskData SQLTask:Connection="{674108CD-DB02-4343-85C4-0B3DFDF94F06}" SQLTask:TimeOut="0" SQLTask:IsStoredProc="False" SQLTask:SqlStmtSourceType="DirectInput" SQLTask:SqlStatementSource="use dds&#xA;go&#xA;&#xA;-- Update if exists&#xA;update fact_product_sales&#xA;set sales_date_key = dd.date_key&#xA;, customer_key = oh.customer_key&#xA;, product_key = oi.product_key&#xA;, store_key = oh.store_key&#xA;, order_id = oh.order_id&#xA;, line_number = oi.line_number&#xA;, quantity = oi.quantity&#xA;, unit_price = oi.unit_price&#xA;, unit_cost = oi.unit_cost&#xA;, sales_value = oi.sales_value&#xA;, sales_cost = oi.sales_cost&#xA;, margin = oi.margin&#xA;, sales_timestamp = oi.create_timestamp&#xA;, source_system_code = oh.source_system_code&#xA;, update_timestamp = getdate()&#xA;from nds.dbo.order_header oh&#xA;inner join fact_product_sales fps&#xA;  on fps.order_id = oh.order_id&#xA;left join dim_date dd&#xA;  on oh.sales_date = dd.sql_date&#xA;inner join nds.dbo.order_item oi&#xA;  on oh.order_key = oi.order_key&#xA; and fps.line_number = oi.line_number&#xA;where fps.sales_date_key &lt;&gt; dd.date_key&#xA;or fps.customer_key &lt;&gt; oh.customer_key&#xA;or fps.product_key &lt;&gt; oi.product_key&#xA;or fps.store_key &lt;&gt; oh.store_key&#xA;or fps.order_id &lt;&gt; oh.order_id&#xA;or fps.line_number &lt;&gt; oi.line_number&#xA;or fps.quantity &lt;&gt; oi.quantity&#xA;or fps.unit_price &lt;&gt; oi.unit_price&#xA;or fps.unit_cost &lt;&gt; oi.unit_cost&#xA;or fps.sales_value &lt;&gt; oi.sales_value&#xA;or fps.sales_cost &lt;&gt; oi.sales_cost&#xA;or fps.margin &lt;&gt; oi.margin&#xA;or fps.sales_timestamp &lt;&gt; oi.create_timestamp&#xA;or fps.source_system_code &lt;&gt; oh.source_system_code&#xA;go&#xA;&#xA;-- Insert if not exists&#xA;insert into fact_product_sales&#xA;( sales_date_key, customer_key, product_key&#xA;, store_key, order_id, line_number, quantity&#xA;, unit_price, unit_cost, sales_value, sales_cost&#xA;, margin, sales_timestamp, source_system_code&#xA;, create_timestamp, update_timestamp )&#xA;select dd.date_key as sales_date_key&#xA;, oh.customer_key as customer_key&#xA;, oi.product_key as product_key&#xA;, oh.store_key as store_key&#xA;, oh.order_id as order_id&#xA;, oi.line_number as line_number&#xA;, oi.quantity as quantity&#xA;, oi.unit_price as unit_price&#xA;, oi.unit_cost as unit_cost&#xA;, oi.sales_value as sales_value&#xA;, oi.sales_cost as sales_cost&#xA;, oi.margin as margin&#xA;, oi.create_timestamp as sales_timestamp&#xA;, source_system_code as source_system_code&#xA;, getdate() as create_timestamp&#xA;, getdate() as update_timestamp&#xA;from nds.dbo.order_header oh&#xA;left join dim_date dd &#xA;  on oh.sales_date = dd.sql_date&#xA;inner join nds.dbo.order_item oi&#xA;  on oh.order_key = oi.order_key&#xA;where not exists&#xA;( select * from fact_product_sales fps&#xA;  where fps.order_id = oh.order_id )&#xA;go" SQLTask:ResultType="ResultSetType_None" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask"/></DTS:ObjectData></DTS:Executable>
<DTS:Executable DTS:ExecutableType="Microsoft.SqlServer.Dts.Tasks.ExecuteSQLTask.ExecuteSQLTask, Microsoft.SqlServer.SQLTask, Version=9.0.242.0, Culture=neutral, PublicKeyToken=89845dcd8080cc91" DTS:ThreadHint="0"><DTS:Property DTS:Name="ExecutionLocation">0</DTS:Property><DTS:Property DTS:Name="ExecutionAddress"></DTS:Property><DTS:Property DTS:Name="TaskContact">Execute SQL Task; Microsoft Corporation; Microsoft SQL Server v9; © 2004 Microsoft Corporation; All Rights Reserved;http://www.microsoft.com/sql/support/default.asp;1</DTS:Property><DTS:Property DTS:Name="ForceExecValue">0</DTS:Property><DTS:Property DTS:Name="ExecValue" DTS:DataType="3">0</DTS:Property><DTS:Property DTS:Name="ForceExecutionResult">-1</DTS:Property><DTS:Property DTS:Name="Disabled">0</DTS:Property><DTS:Property DTS:Name="FailPackageOnFailure">0</DTS:Property><DTS:Property DTS:Name="FailParentOnFailure">0</DTS:Property><DTS:Property DTS:Name="MaxErrorCount">1</DTS:Property><DTS:Property DTS:Name="ISOLevel">1048576</DTS:Property><DTS:Property DTS:Name="LocaleID">-1</DTS:Property><DTS:Property DTS:Name="TransactionOption">1</DTS:Property><DTS:Property DTS:Name="DelayValidation">0</DTS:Property>
<DTS:LoggingOptions><DTS:Property DTS:Name="LoggingMode">0</DTS:Property><DTS:Property DTS:Name="FilterKind">1</DTS:Property><DTS:Property DTS:Name="EventFilter" DTS:DataType="8"></DTS:Property></DTS:LoggingOptions><DTS:Property DTS:Name="ObjectName">Upsert Order Detail</DTS:Property><DTS:Property DTS:Name="DTSID">{5EA68E35-346B-45E7-9329-E9FF5A9A26ED}</DTS:Property><DTS:Property DTS:Name="Description">Execute SQL Task</DTS:Property><DTS:Property DTS:Name="CreationName">Microsoft.SqlServer.Dts.Tasks.ExecuteSQLTask.ExecuteSQLTask, Microsoft.SqlServer.SQLTask, Version=9.0.242.0, Culture=neutral, PublicKeyToken=89845dcd8080cc91</DTS:Property><DTS:Property DTS:Name="DisableEventHandlers">0</DTS:Property><DTS:ObjectData><SQLTask:SqlTaskData SQLTask:Connection="{674108CD-DB02-4343-85C4-0B3DFDF94F06}" SQLTask:TimeOut="0" SQLTask:IsStoredProc="False" SQLTask:SqlStmtSourceType="DirectInput" SQLTask:SqlStatementSource="use nds&#xA;go&#xA;&#xA;-- Update where exists&#xA;update order_item&#xA;set product_key = coalesce(p.product_key, 0) &#xA;, quantity = od.qty&#xA;, unit_price = od.price&#xA;, unit_cost = od.unit_cost&#xA;, sales_value = od.qty * od.price&#xA;, sales_cost = od.qty * od.unit_cost&#xA;, margin = od.qty * (od.price-od.unit_cost) &#xA;, currency_key = oh.currency_key&#xA;, currency_rate = cr.currency_rate&#xA;, unit_price_usd = od.price * cr.currency_rate&#xA;, unit_cost_usd = od.unit_cost * cr.currency_rate&#xA;, sales_value_usd = od.qty * od.price * cr.currency_rate&#xA;, sales_cost_usd = od.qty * od.unit_cost * cr.currency_rate&#xA;, margin_usd = od.qty * (od.price-od.unit_cost) * cr.currency_rate&#xA;from stage.dbo.order_detail od&#xA;left join product p&#xA;  on od.product_code = p.product_code&#xA;left join order_header oh&#xA;  on od.order_id = oh.order_id&#xA;left join currency_rate cr&#xA;  on cr.currency_key = oh.currency_key &#xA; and cr.currency_key = &#xA; convert(datetime,&#xA; convert(varchar, year(getdate())) &#xA; + '-' &#xA; + right('0'+convert(varchar, month(getdate())),2) &#xA; +  '-01')&#xA;left join order_item oi&#xA;  on oi.order_key = oh.order_key&#xA; and oi.line_number = coalesce(od.line_no, 0)&#xA;where oi.product_key &lt;&gt; coalesce(p.product_key, 0) &#xA;or oi.quantity &lt;&gt; od.qty&#xA;or oi.unit_price &lt;&gt; od.price&#xA;or oi.unit_cost &lt;&gt; od.unit_cost&#xA;or oi.sales_value &lt;&gt; od.qty * od.price&#xA;or oi.sales_cost &lt;&gt; od.qty * od.unit_cost&#xA;or oi.margin &lt;&gt; od.qty * (od.price-od.unit_cost) &#xA;or oi.currency_key &lt;&gt; oh.currency_key&#xA;or oi.currency_rate &lt;&gt; cr.currency_rate&#xA;or oi.unit_price_usd &lt;&gt; od.price * cr.currency_rate&#xA;or oi.unit_cost_usd &lt;&gt; od.unit_cost * cr.currency_rate&#xA;or oi.sales_value_usd &lt;&gt; od.qty * od.price * cr.currency_rate&#xA;or oi.sales_cost_usd &lt;&gt; od.qty * od.unit_cost * cr.currency_rate&#xA;or oi.margin_usd &lt;&gt; od.qty * (od.price-od.unit_cost) * cr.currency_rate&#xA;go&#xA;&#xA;-- Insert where not exists&#xA;insert into order_item&#xA;( order_key, line_number, product_key, quantity&#xA;, unit_price, unit_cost, sales_value, sales_cost&#xA;, margin, currency_key, currency_rate&#xA;, unit_price_usd, unit_cost_usd&#xA;, sales_value_usd, sales_cost_usd&#xA;, margin_usd, source_system_code&#xA;, create_timestamp, update_timestamp )&#xA;select oh.order_key as order_key&#xA;, coalesce(od.line_no, 0) as line_number&#xA;, coalesce(p.product_key, 0) as product_key&#xA;, od.qty as quantity, od.price as unit_price&#xA;, od.unit_cost as unit_cost&#xA;, od.qty * od.price as sales_value&#xA;, od.qty * od.unit_cost as sales_cost&#xA;, od.qty * (od.price-od.unit_cost) as margin&#xA;, oh.currency_key, cr.currency_rate&#xA;, od.price * cr.currency_rate as unit_price_usd&#xA;, od.unit_cost * cr.currency_rate as unit_cost_usd&#xA;, od.qty * od.price * cr.currency_rate as sales_value_usd&#xA;, od.qty * od.unit_cost * cr.currency_rate as sales_cost_usd&#xA;, od.qty * (od.price-od.unit_cost) * cr.currency_rate as margin_usd&#xA;, 1 as source_system_code&#xA;, getdate() as create_timestamp&#xA;, getdate() as update_timestamp&#xA;from stage.dbo.order_detail od&#xA;left join product p&#xA;  on od.product_code = p.product_code&#xA;left join order_header oh&#xA;  on od.order_id = oh.order_id&#xA;left join currency_rate cr&#xA;  on cr.currency_key = oh.currency_key &#xA; and cr.currency_key = &#xA; convert(datetime,&#xA; convert(varchar, year(getdate())) &#xA; + '-' &#xA; + right('0'+convert(varchar, month(getdate())),2) &#xA; +  '-01')&#xA;where not exists &#xA;( select * from order_item oi&#xA;  where oi.order_key = oh.order_key )&#xA;go" SQLTask:ResultType="ResultSetType_None" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask"/></DTS:ObjectData></DTS:Executable>
<DTS:PrecedenceConstraint><DTS:Property DTS:Name="Value">0</DTS:Property><DTS:Property DTS:Name="EvalOp">2</DTS:Property><DTS:Property DTS:Name="LogicalAnd">-1</DTS:Property><DTS:Property DTS:Name="Expression"></DTS:Property><DTS:Executable IDREF="{956E60CF-3EA3-44F9-82E4-6828058541AA}" DTS:IsFrom="-1"/><DTS:Executable IDREF="{E6788F08-9B56-449A-9118-3650DC93D4E8}" DTS:IsFrom="0"/><DTS:Property DTS:Name="ObjectName">Constraint</DTS:Property><DTS:Property DTS:Name="DTSID">{C73A5AEC-B847-49C0-8371-98A3C14881A2}</DTS:Property><DTS:Property DTS:Name="Description"></DTS:Property><DTS:Property DTS:Name="CreationName"></DTS:Property></DTS:PrecedenceConstraint>
<DTS:PrecedenceConstraint><DTS:Property DTS:Name="Value">0</DTS:Property><DTS:Property DTS:Name="EvalOp">2</DTS:Property><DTS:Property DTS:Name="LogicalAnd">-1</DTS:Property><DTS:Property DTS:Name="Expression"></DTS:Property><DTS:Executable IDREF="{E6788F08-9B56-449A-9118-3650DC93D4E8}" DTS:IsFrom="-1"/><DTS:Executable IDREF="{BAE4C9E8-06A6-41C3-BEA9-7EBCD72EF88E}" DTS:IsFrom="0"/><DTS:Property DTS:Name="ObjectName">Constraint 1</DTS:Property><DTS:Property DTS:Name="DTSID">{F2820D4F-E525-425B-9D80-2EC0BB588546}</DTS:Property><DTS:Property DTS:Name="Description"></DTS:Property><DTS:Property DTS:Name="CreationName"></DTS:Property></DTS:PrecedenceConstraint>
<DTS:PrecedenceConstraint><DTS:Property DTS:Name="Value">0</DTS:Property><DTS:Property DTS:Name="EvalOp">2</DTS:Property><DTS:Property DTS:Name="LogicalAnd">-1</DTS:Property><DTS:Property DTS:Name="Expression"></DTS:Property><DTS:Executable IDREF="{BAE4C9E8-06A6-41C3-BEA9-7EBCD72EF88E}" DTS:IsFrom="-1"/><DTS:Executable IDREF="{5EA68E35-346B-45E7-9329-E9FF5A9A26ED}" DTS:IsFrom="0"/><DTS:Property DTS:Name="ObjectName">Constraint 2</DTS:Property><DTS:Property DTS:Name="DTSID">{20D5C0EE-14DA-4FBB-BC96-D60624DE3D93}</DTS:Property><DTS:Property DTS:Name="Description"></DTS:Property><DTS:Property DTS:Name="CreationName"></DTS:Property></DTS:PrecedenceConstraint><DTS:Property DTS:Name="ObjectName">NDS order</DTS:Property><DTS:Property DTS:Name="DTSID">{33944366-DCD1-4DB0-BA36-2D150C635211}</DTS:Property><DTS:Property DTS:Name="Description"></DTS:Property><DTS:Property DTS:Name="CreationName">MSDTS.Package.1</DTS:Property><DTS:Property DTS:Name="DisableEventHandlers">0</DTS:Property></DTS:Executable>